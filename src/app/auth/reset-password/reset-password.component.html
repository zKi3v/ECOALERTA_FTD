<div class="auth-container">
  <div class="eco-nav-bar">
    <div class="eco-nav-actions">
      <button mat-raised-button color="primary" routerLink="/">INICIO</button>
    </div>
  </div>

  <mat-card class="auth-card">
    <div class="card-header">
      <div class="eco-logo">üå± EcoAlerta</div>
      <h2>Restablecer Contrase√±a</h2>
      <p class="subtitle">Ingresa tu nueva contrase√±a</p>
    </div>

    <div *ngIf="isLoading" class="loading-container">
      <p>Validando enlace...</p>
    </div>

    <form *ngIf="!isLoading && isValidToken" [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="auth-form">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nueva Contrase√±a</mat-label>
        <input 
          matInput 
          [type]="hidePassword ? 'password' : 'text'" 
          formControlName="nuevaContrasena"
          placeholder="Ingresa tu nueva contrase√±a"
        >
        <button 
          mat-icon-button 
          matSuffix 
          type="button"
          (click)="hidePassword = !hidePassword" 
          [attr.aria-label]="'Hide password'" 
          [attr.aria-pressed]="hidePassword"
        >
          <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        @if (resetForm.get('nuevaContrasena')?.invalid && resetForm.get('nuevaContrasena')?.touched) {
          <mat-error>
            La contrase√±a debe tener al menos 6 caracteres
          </mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirmar Nueva Contrase√±a</mat-label>
        <input 
          matInput 
          [type]="hideConfirmPassword ? 'password' : 'text'" 
          formControlName="confirmarContrasena"
          placeholder="Confirma tu nueva contrase√±a"
        >
        <button 
          mat-icon-button 
          matSuffix 
          type="button"
          (click)="hideConfirmPassword = !hideConfirmPassword" 
          [attr.aria-label]="'Hide password'" 
          [attr.aria-pressed]="hideConfirmPassword"
        >
          <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        @if (resetForm.get('confirmarContrasena')?.invalid && resetForm.get('confirmarContrasena')?.touched) {
          <mat-error>
            Este campo es obligatorio
          </mat-error>
        }
        @if (resetForm.hasError('passwordMismatch') && resetForm.get('confirmarContrasena')?.touched) {
          <mat-error>
            Las contrase√±as no coinciden
          </mat-error>
        }
      </mat-form-field>

      <button 
        mat-raised-button 
        color="primary" 
        type="submit" 
        class="submit-button" 
        [disabled]="!resetForm.valid"
      >
        RESTABLECER CONTRASE√ëA
      </button>
    </form>

    <div class="auth-links">
      <button mat-button type="button" (click)="goToLogin()" class="back-link">
        ‚Üê Volver al inicio de sesi√≥n
      </button>
    </div>
  </mat-card>
</div>